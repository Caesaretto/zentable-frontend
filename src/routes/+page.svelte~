<script>
    import { onMount } from 'svelte';
    import { supabase } from '$lib/supabaseClient';
    import { goto } from '$app/navigation';

    let session = null;
    let nome_proprietario = '';

    onMount(async () => {
        const { data } = await supabase.auth.getSession();
        session = data.session;

        if (session) {
            const { data: restaurantData } = await supabase
                .from('ristoranti')
                .select('nome_proprietario')
                .eq('user_id', session.user.id)
                .single();
            
            if (restaurantData && restaurantData.nome_proprietario) {
                nome_proprietario = restaurantData.nome_proprietario;
            }
        }
    });

    async function handleLogout() {
        await supabase.auth.signOut();
        session = null;
    }
</script>

{#if session}
  <div class="user-panel">
    <span class="user-welcome">
      Ciao, {nome_proprietario || session.user.email.split('@')[0]}
    </span>
    <div class="user-actions">
        <a href="/dashboard" class="contrast">La Tua ZENboard</a>
        <button on:click={handleLogout} class="logout-button">Logout</button>
    </div>
  </div>
{/if}

<div class="page-wrapper">
    <section class="hero">
        <div class="hero-content">
            <img src="/logo.png" alt="Logo Zentable" class="logo">
            
            <div class="headings">
                <h2>Gestisce le prenotazioni del tuo ristorante.</h2>
                <p class="tagline">Mentre tu resti <span class="accent">zen.</span></p>
            </div>
            
            <p class="description">
                Una piattaforma di gestione intelligente,<br>pensata per chi lavora da chi lavora (e resta zen).
            </p>

            <div class="cta-buttons">
                <a href="/register" class="btn-brush primary"><span>Diventa<br>Zen</span></a>
                <a href="/login" class="btn-brush secondary"><span>Accedi</span></a>
            </div>
        </div>
    </section>

    <section class="container" id="about">
        <hgroup>
            <h2>Tutto sotto controllo, con un click.</h2>
            <p>Abbiamo creato gli strumenti che ti servono, eliminando tutto il resto.</p>
        </hgroup>
        <div class="features-grid">
            <div class="feature-card">
                <img src="/spunta-nera.png" alt="Icona Intuitivo" class="feature-icon">
                <h3>Intuitivo</h3>
                <p>Una timeline visiva dove ogni click è un'azione. Niente menu complicati.</p>
            </div>
            <div class="feature-card">
                <img src="/spunta-rossa.png" alt="Icona Semplice" class="feature-icon">
                <h3>Semplice</h3>
                <p>Configuri tutto in pochi minuti e il sistema lavora per te, 24/7.</p>
            </div>
            <div class="feature-card">
                <img src="/spunta-nera.png" alt="Icona Automatico" class="feature-icon">
                <h3>Automatico</h3>
                <p>La timeline si aggiorna da sola e i clienti ricevono conferme istantanee.</p>
            </div>
        </div>
    </section>

    <section class="container" id="prezzi">
        <article class="pricing-card">
            <hgroup>
                <h1><span class="accent">ZEN</span>plan</h1>
                <h2>Un solo piano.<br>Nessuna sorpresa.</h2>
            </hgroup>
            
            <p class="price">29€ <span class="per-month">/ mese</span></p>
            
            <div class="pricing-features">
                <div class="pricing-item">
                    <img src="/enso-piccolo.png" alt="Enso icon" class="enso-icon">
                    <span>Prenotazioni Illimitate</span>
                </div>
                <div class="pricing-item">
                    <img src="/enso-piccolo.png" alt="Enso icon" class="enso-icon">
                    <span>Tavoli Illimitati</span>
                </div>
                <div class="pricing-item">
                    <img src="/enso-piccolo.png" alt="Enso icon" class="enso-icon">
                    <span>Notifiche Email Illimitate</span>
                </div>
                <div class="pricing-item">
                    <img src="/enso-piccolo.png" alt="Enso icon" class="enso-icon">
                    <span>1.000 WhatsApp/mese Inclusi</span>
                </div>
                <div class="pricing-item">
                    <img src="/enso-piccolo.png" alt="Enso icon" class="enso-icon">
                    <span>Supporto Zen</span>
                </div>
            </div>
            <a href="/register" role="button" class="contrast">Inizia la Tua Prova Gratuita</a>
        </article>
    </section>
</div>


<style>
  .page-wrapper { width: 100%; }
  section { padding: 4rem 2rem; box-sizing: border-box; }
  
  .hero {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    text-align: center;
  }
  .hero-content { max-width: 800px; }
  .logo { width: 180px; height: auto; margin-bottom: 2rem; }
  .headings h2 { font-size: 1.6rem; font-weight: 700; margin: 0; white-space: nowrap; }
  .tagline { font-size: 1.4rem; color: var(--muted-color); margin-top: 0.5rem; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 300; }
  .tagline .accent { color: var(--primary); font-weight: 700; }
  .description { font-size: 1rem; line-height: 1.6; margin-bottom: 1rem; }
  .cta-buttons { margin-top: 2rem; display: flex; gap: 2.5rem; align-items: center; justify-content: center; }
  .btn-brush {
    position: relative; display: flex; justify-content: center; align-items: center;
    width: 180px; height: 180px; text-decoration: none;
    text-transform: uppercase; letter-spacing: 0.1em; transition: transform 0.2s;
    line-height: 1.2; box-sizing: border-box; border: none; background-size: contain;
    background-repeat: no-repeat; background-position: center;
    font-weight: 700;
  }
  .btn-brush span { position: relative; z-index: 1; }
  .btn-brush:hover { transform: scale(1.05); }
  .btn-brush.primary { background-image: url('/pennellata-nera.png'); color: var(--primary); }
  .btn-brush.secondary { background-image: url('/pennellata-rossa.png'); color: var(--text-color); }
  
  .user-panel { position: absolute; top: 2rem; right: 2rem; display: flex; align-items: center; gap: 1rem; }
  .user-welcome { font-weight: 700; }
  
  #about { background-color: var(--card-background-color); }
  #about hgroup, #prezzi hgroup { text-align: center; margin-bottom: 3rem; }
  .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; }
  .feature-card { text-align: center; }
  .feature-icon { height: 40px; margin-bottom: 1rem; }
  
  #prezzi .pricing-card { max-width: 450px; margin: 0 auto; text-align: center; padding: 2rem; }
  .price { font-size: 3rem; font-weight: 700; margin: 0; }
  .per-month { font-size: 1rem; font-weight: 300; color: var(--muted-color); }
  #prezzi hgroup h1 { font-size: 2rem; }
  #prezzi hgroup .accent { color: var(--primary); }
  #prezzi hgroup h2 { font-size: 1rem; font-weight: 300; text-transform: none; letter-spacing: normal; }
  .pricing-features { margin: 2rem 0; text-align: left; display: inline-block; }
  .pricing-item { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
  .enso-icon { height: 20px; }

  @media (max-width: 768px) {
    .headings h2 { white-space: normal; }
    .cta-buttons { flex-direction: column; gap: 2rem; }
  }
</style>
